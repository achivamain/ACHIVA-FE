# ACHIVA-FE 최적화 작업 지시서 (개발자 전달용)

작성일: 2026-02-03  
목표: 성능/유지보수 리스크를 최소 비용으로 단계적으로 개선

---

## 범위 및 전제
- 기존 기능 유지가 최우선이며, 점진 개선 방식으로 진행
- 1~2명 기준, 단계별로 릴리즈 가능하게 분리
- 결과는 “사용자 체감 속도 개선 + 유지보수 비용 절감”에 집중

---

## 실행 로드맵

### 2주 (즉시 체감 개선)
1. 홈 피드 N+1 요청 제거
2. 유저 정보 조회 상위로 이동
3. React Query 캐시 정책 정리
4. 모바일 리라이트 로직 예외 보강

### 4주 (구조 안정화)
1. 임시 캐시 제거(PostsBookIdCache)
2. 이미지 로딩 최적화
3. 피드 API 응답 구조 정리(응원 포함 여부 확정)

### 8주 (구조/유지보수 혁신)
1. 모바일/데스크 중복 구조 통합 설계 및 단계 적용

---

## 작업 지시서 (항목별 상세)

### 1) 홈 피드 응원 데이터 N+1 제거
- 목표: 피드 로딩 시 “게시물 수만큼 추가 요청” 제거
- 현재 위치:
  - `features/home/Section1.tsx`
  - `features/home/Section2.tsx`
- 작업 지시:
  1. 백엔드와 합의하여 피드 API가 응원 데이터를 포함하도록 변경
  2. 프론트에서 `/api/cheerings?postId=...` 반복 호출 제거
  3. 응원 데이터가 없을 경우에도 안전하게 렌더링되도록 fallback 처리
- 완료 기준:
  - 피드 로딩 시 응원 요청이 반복되지 않음
  - 첫 화면 로딩 시 네트워크 요청 수가 크게 감소

---

### 2) 유저 정보 조회 상위로 이동
- 목표: 게시물 컴포넌트마다 중복 요청 제거
- 현재 위치:
  - `features/home/Post.tsx`
- 작업 지시:
  1. 상위 컴포넌트에서 `/api/members/me`를 1회만 호출
  2. 하위 컴포넌트에 props로 전달
  3. 기존 useQuery 제거
- 완료 기준:
  - 피드 내 게시물 수와 관계없이 유저 정보 요청은 1회

---

### 3) React Query 캐시 정책 정리
- 목표: 불필요한 재요청 방지
- 현재 위치:
  - `features/home/Section1.tsx`
  - `features/home/Section2.tsx`
- 작업 지시:
  1. `staleTime` 합리적 값 설정 (예: 30~60초)
  2. `refetchOnWindowFocus` 정책 결정 (보통 false)
  3. 무한 스크롤 페이지 캐시가 유지되도록 설정
- 완료 기준:
  - 탭 이동/포커스 시 과도한 재요청이 발생하지 않음

---

### 4) 모바일 리라이트 로직 예외 보강
- 목표: `/m` 경로 중복 리라이트 방지
- 현재 위치:
  - `middleware.tsx`
- 작업 지시:
  1. 이미 `/m`로 시작하는 경로는 리라이트에서 제외
  2. 콜백/정적 파일/이미지 경로 예외 확인
  3. 모바일/데스크 직접 접근 테스트
- 완료 기준:
  - `/m` 경로가 이중 리라이트되지 않음

---

### 5) 임시 캐시(PostsBookIdCache) 제거
- 목표: 새로고침/직접 접근 시 정보 누락 문제 제거
- 현재 위치:
  - `features/post/PostsBookIdCache.ts`
  - `features/home/Section1.tsx`
  - `features/home/Section2.tsx`
- 작업 지시:
  1. 상세 페이지에서 필요한 책 정보는 API로 직접 획득
  2. 캐시 의존 로직 제거
  3. 새로고침/직접 접근 테스트
- 완료 기준:
  - 상세 페이지에서 책 정보가 항상 정상 노출

---

### 6) 이미지 로딩 최적화
- 목표: 불필요한 대용량 이미지 다운로드 감소
- 현재 위치:
  - `components/PostImg.tsx`
  - `components/ProfileImg.tsx`
- 작업 지시:
  1. `sizes` 속성 지정 (반응형 환경 고려)
  2. 중요 이미지 우선 로딩 설정
  3. 큰 이미지 다운로드가 반복되지 않도록 정책 검토
- 완료 기준:
  - 모바일 환경에서 페이지 용량 감소

---

### 7) 모바일/데스크 구조 통합 설계
- 목표: 유지보수 비용 절반 이하로 감소
- 현재 위치:
  - `app/`
  - `app/m/`
- 작업 지시:
  1. 공통 화면/기능 목록화
  2. 반응형으로 통합 가능한 영역 선별
  3. 우선순위 높은 화면부터 통합 적용
  4. `/m` 경로 유지/폐지 정책 결정
- 완료 기준:
  - 공통 기능은 한 곳에서만 수정하면 되도록 변경

---

## 산출물 요구사항
- 각 항목별 작업 완료 시 PR 단위로 분리
- 배포 전 체크리스트(간단 테스트 항목) 포함

---

## 문의/결정 필요 사항
- 피드 API 응원 데이터 포함 여부 (백엔드 합의 필요)
- 모바일/데스크 통합 범위와 `/m` 경로 정책
